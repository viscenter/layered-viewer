function pageNames(){return array=pages.map(function(e){return e.name}),array}function resetView(){primary.viewport.goHome(),secondary.viewport.goHome()}function zoomOut(){primary.viewport.zoomBy(.8)}function zoomIn(){primary.viewport.zoomBy(1.2)}function prevPage(){pageIndex=0!==pageIndex?(pageIndex-1+numPages)%numPages:numPages-1,updatePage()}function nextPage(){pageIndex=pageIndex!==numPages-1?(pageIndex+1)%numPages:0,updatePage()}function gotoPage(e){pageIndex=e,updatePage()}function invalidate(){isValid=!1}function validate(){0==isValid&&(primary.forceRedraw(),isValid=!0)}function Flashlight(){this.x=0,this.y=0,this.clipSize=10,this.fill="white"}function addFlashlight(e,t,a){var i=new Flashlight;i.x=e,i.y=t,i.clipSize=a,flashlights.push(i),invalidate()}function drawIndicator(e,t,a,i){var o=flashlightIndicatorSize;i&&(o=flashlightIndicatorSize+.15*flashlightIndicatorSize),a.beginPath(),a.arc(e.canvasPosition().x,e.canvasPosition().y,o,0,2*Math.PI,!1),a.shadowOffsetX=1.5,a.shadowOffsetY=1.5,a.shadowBlur=7,a.shadowColor="black",a.fillStyle=t,a.fill(),a.closePath(),resetContext(a)}function resetContext(e){e.globalAlpha=1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0}function drawFlashlights(){for(var e=0;e<flashlights.length;e++){cursor.isCircle?cutCircle(flashlights[e].canvasPosition().x,flashlights[e].canvasPosition().y,flashlights[e].clipSize/2):cutSquare(flashlights[e].canvasPosition().x,flashlights[e].canvasPosition().y,flashlights[e].clipSize);var t=!1;e==whichFlashlight&&(t=!0),drawIndicator(flashlights[e],flashlights[e].fill,ctx,t)}}function cutCircle(e,t,a){a*=primary.viewport.getZoom(),ctx.save(),ctx.globalCompositeOperation="destination-out",ctx.beginPath(),ctx.arc(e,t,a,0,2*Math.PI,!1),ctx.fill(),ctx.restore()}function cutSquare(e,t,a){a*=primary.viewport.getZoom(),ctx.clearRect(e-a/2,t-a/2,a,a)}function makeGhostCanvas(){ghostcanvas=document.createElement("canvas"),ghostcanvas.width=pc.width,ghostcanvas.height=pc.height,ghostctx=ghostcanvas.getContext("2d")}function clearGhostCanvas(){ghostctx.clearRect(0,0,ghostcanvas.width,ghostcanvas.height)}function getIndicatorClicked(e){clearGhostCanvas();for(var t=0;t<flashlights.length;t++){drawIndicator(flashlights[t],"black",ghostctx);var a=ghostctx.getImageData(e.x,e.y,1,1);if(a.data[3]>0)return whichFlashlight=t,!0;clearGhostCanvas()}return whichFlashlight=null,!1}function updatePrimaryImage(){var e=primary.viewport.getZoom(!1),t=primary.viewport.getCenter(!1);primary.open(pages[pageIndex].layers[primaryLayerIndex].dzi),setTimeout(function(){primary.viewport.zoomTo(e),primary.viewport.panTo(t)},updateDelay)}function updateSecondaryImage(){var e=secondary.viewport.getZoom(!1),t=primary.viewport.getCenter(!1);secondary.open(pages[pageIndex].layers[secondaryLayerIndex].dzi),setTimeout(function(){secondary.viewport.zoomTo(e),secondary.viewport.panTo(t)},updateDelay)}function updateSearchBar(){pageID.value=pages[pageIndex].name}function updatePage(){numLayers=pages[pageIndex].layers.length,primaryLayerIndex=Math.min(primaryLayerIndex,numLayers-1),secondaryLayerIndex=Math.min(secondaryLayerIndex,numLayers-1),updatePrimaryImage(),updateSecondaryImage(),updateSearchBar(),fillSlider(),sly.activate(primaryLayerIndex),updateSecondaryCard()}function onViewerScroll(e){if(e.shift){var t=15,a=primary.world.getItemAt(0).getContentSize().y;e.preventDefaultAction=!0;var i=e.originalEvent.wheelDelta/5,o=flashlights[0].clipSize+i;t>o?flashlights[0].clipSize=t:o>a?flashlights[0].clipSize=a:flashlights[0].clipSize=o,invalidate()}}function onViewerPress(e){getIndicatorClicked(e.position)&&(e.preventDefaultAction=!0,e.stopBubbling=!0,movingFlashlight=!0),invalidate()}function onViewerDrag(e){if(movingFlashlight){e.preventDefaultAction=!0,e.stopBubbling=!0;var t=new OpenSeadragon.Point(e.delta.x,e.delta.y),a=t.divide(pc.width,pc.height),i=primary.viewport.getZoom();a=a.divide(i);var o=primary.world.getItemAt(0).getBounds();a.x=a.x/o.width,a.y=a.y/o.height,flashlights[whichFlashlight].x+=a.x,flashlights[whichFlashlight].y+=a.y,invalidate()}}function onViewerRelease(e){movingFlashlight&&(e.preventDefaultAction=!0,e.stopBubbling=!0,whichFlashlight=null,movingFlashlight=!1),invalidate()}function fillSlider(){for(cards=sly.items.length,i=0;i<cards;i++)sly.remove(0);for(i=0;i<numLayers;i++){version=pages[pageIndex].layers[i].version;var e="";e='<li id="'+i+'"><paper-material class="layer-card" elevation="1"><span class="vertically-aligned">'+version+"</span></paper-material></li>",sly.add(e)}}function fillPageSelector(){var e="";for(id=0;id<pageNames().length;id++)e='<li class="page-item" id="'+id+'" onclick="gotoPage('+id+')">'+pageNames()[id]+"</li>",$("#page-selector").append(e)}function updateSecondaryCard(){var e=$("#slidee").find(".second-active");e.removeClass("second-active"),e.find("span").find(".circle.indicator").remove();var t='<div class="circle indicator"></div>',a=$("#slidee").find("#"+secondaryLayerIndex);a.addClass("second-active"),a.find("span").prepend(t)}function toggleLayerSelector(){"none"==$("#layer-selector").css("display")?$("#layer-selector-toggle").animate({"margin-bottom":"-15px"},{step:function(e,t){var a=-(180*(e+15))/25;$(this).find("iron-icon").css("-ms-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("-webkit-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("transform","rotate("+a+"deg)")}},400):$("#layer-selector-toggle").animate({"margin-bottom":"10px"},{step:function(e,t){var a=180*(e+15)/25;$(this).find("iron-icon").css("-ms-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("-webkit-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("transform","rotate("+a+"deg)")}},400),$("#layer-selector").slideToggle(400),sly.reload()}function onHelpConfirm(){startTour()}function onHelpClose(){primary.setMouseNavEnabled(!0),$(".navigator").show()}function startTour(){primary.setMouseNavEnabled(!1),$(".navigator").hide(),resetView();var e=primary.viewport.contentSize.x*primary.viewport.viewportToImageZoom(primary.viewport.getZoom())/2;tour.getById("background").options.tetherOptions.offset="0 -"+e+"px",tour.getById("background").options.text=backgroundText+pages[pageIndex].layers[primaryLayerIndex].version+".";var t=flashlights[0].clipSize*primary.viewport.getZoom()/2;tour.getById("flashlight").options.tetherOptions.offset="0 -"+t+"px",tour.getById("flashlight").options.text=flashlightText+pages[pageIndex].layers[secondaryLayerIndex].version+".",elemBeforeActive=$("li.active").prev(),0===elemBeforeActive.length?elemBeforeActive=$("li.active")[0]:elemBeforeActive=elemBeforeActive[0],tour.getById("changePrimary").options.attachTo={element:elemBeforeActive,on:"left"},"none"==$("#layer-selector").css("display")&&toggleLayerSelector(),tour.start()}function startDemoRotation(){var e={delta:{x:0,y:0}};movingFlashlight=!0,whichFlashlight=demoLight,original.x=flashlights[demoLight].x,original.y=flashlights[demoLight].y,flashlights[demoLight].x+=10/pc.width/primary.viewport.getZoom(),flashlights[demoLight].y-=10/pc.height/primary.viewport.getZoom(),modulator=setInterval(function(){var t=Math.cos(toRadian(angle)),a=Math.sin(toRadian(angle));e.delta.x=t,e.delta.y=a,onViewerDrag(e),angle+=theta+.5},1)}function resetDemoRotation(){clearInterval(modulator),angle=0,flashlights[demoLight].x=original.x,flashlights[demoLight].y=original.y,original={},movingFlashlight=!1,whichFlashlight=null,invalidate()}function startDemoScroll(){var e={originalEvent:{wheelDelta:0}};shiftDown=!0,whichFlashlight=demoLight,original.clipSize=flashlights[demoLight].clipSize,modulator=setInterval(function(){e.originalEvent.wheelDelta=50*Math.sin(toRadian(angle)),onViewerScroll(e),angle+=theta},1)}function resetDemoScroll(){clearInterval(modulator),angle=0,flashlights[demoLight].clipSize=original.clipSize,original={},shiftDown=!1,whichFlashlight=null,invalidate()}function toRadian(e){return e*Math.PI/180}function toDegree(e){return 180*e/Math.PI}var defaultImageSetJSONFile,defaultPageIndex,defaultprimaryLayerIndex,defaultSecondaryLayerIndex;"infoforest.vis.uky.edu"==window.location.hostname?(defaultImageSetJSONFile="data/chad.json",defaultPageIndex=223,defaultPrimaryLayerIndex=4,defaultSecondaryLayerIndex=2):(defaultImageSetJSONFile="test/data/test.json",defaultPageIndex=0,defaultPrimaryLayerIndex=0,defaultSecondaryLayerIndex=1);var OSDprefixURL="external/openseadragon/images/",showNav=!0,showFull=!1,showScale=!0,scaleMinWidth="75px",minZoom=.15,maxZoom=2,animationTime=0,imageSetJSONFile=defaultImageSetJSONFile,pageIndex=defaultPageIndex,primaryLayerIndex=defaultPrimaryLayerIndex,secondaryLayerIndex=defaultSecondaryLayerIndex,movingFlashlight=!1,whichFlashlight=null,flashlightIndicatorSize=5,cursor={clipSize:500,isCircle:!0},json=$.ajax({url:imageSetJSONFile,async:!1,dataType:"json"}).responseText,pages=$.parseJSON(json).pages,numPages=pages.length,numLayers=pages[pageIndex].layers.length,primary=OpenSeadragon({id:"primary",prefixUrl:OSDprefixURL,tileSources:pages[pageIndex].layers[primaryLayerIndex].dzi,showNavigator:showNav,navigatorID:"navigator-wrapper",animationTime:animationTime,minZoomLevel:minZoom,maxZoomLevel:maxZoom,showFullPageControl:!1,showNavigationControl:!1,zoomPerScroll:1.1}),secondary=OpenSeadragon({id:"secondary",prefixUrl:OSDprefixURL,tileSources:pages[pageIndex].layers[secondaryLayerIndex].dzi,showNavigator:!1,animationTime:animationTime,minZoomLevel:minZoom,maxZoomLevel:maxZoom,showFullPageControl:!1,showNavigationControl:!1});showScale&&primary.scalebar({type:OpenSeadragon.ScalebarType.MAP,minWidth:scaleMinWidth,pixelsPerMeter:pages[pageIndex].layers[primaryLayerIndex].pixelsPerMeter,location:OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,xOffset:5,yOffset:10,stayInsideImage:!0,color:"rgba(255, 255, 255, .75)",fontColor:"rgba(255, 255, 255, .75)",fontSize:"small",barThickness:2}),primary.addHandler("pan",function(e){primary&&secondary&&secondary.viewport&&secondary.viewport.panTo(primary.viewport.getCenter(!1)),invalidate()}),primary.addHandler("zoom",function(e){primary&&secondary&&secondary.viewport&&(secondary.viewport.panTo(primary.viewport.getCenter(!1)),secondary.viewport.zoomTo(primary.viewport.getZoom(!1))),invalidate()}),primary.addViewerInputHook({hooks:[{tracker:"viewer",handler:"scrollHandler",hookHandler:onViewerScroll},{tracker:"viewer",handler:"pressHandler",hookHandler:onViewerPress},{tracker:"viewer",handler:"releaseHandler",hookHandler:onViewerRelease},{tracker:"viewer",handler:"dragHandler",hookHandler:onViewerDrag}]}),updateSearchBar();var pc=primary.canvas.children[0];pc||(console.log("Browser must support canvas for client to function."),console.log("Try the latest versions of Firefox or Chromium."),exit(0));var ctx=pc.getContext("2d");setInterval(validate,1),isValid=!1,primary.addHandler("tile-drawn",drawFlashlights);var flashlights=[];Flashlight.prototype.canvasPosition=function(){var e=primary.world.getItemAt(0),t=primary.viewport.getCenter(),a=e.getBounds(),i=e.viewport.getZoom(),o=new OpenSeadragon.Point(this.x,this.y);o.x=o.x*a.width,o.y=o.y*a.height;var r=o.minus(t);r=r.times(i),r=r.times(pc.width,pc.height);var n=new OpenSeadragon.Point(pc.width/2,pc.height/2);return n.plus(r)};var ghostcanvas,ghostctx,updateDelay=50,waitForFinalEvent=function(){var e={};return function(t,a,i){i||(i="Don't call this twice without a uniqueId"),e[i]&&clearTimeout(e[i]),e[i]=setTimeout(t,a)}}();$(window).resize(function(e){waitForFinalEvent(function(){secondary.viewport.panTo(primary.viewport.getCenter(!1)),secondary.viewport.zoomTo(primary.viewport.getZoom(!1)),ghostcanvas.width=pc.width,ghostcanvas.height=pc.height,ghostctx=ghostcanvas.getContext("2d"),invalidate()},50,"resize")});var shiftDown=!1;$(document).keyup(function(e){switch(e.which){default:return}}),$(document).keydown(function(e){switch(e.which){case 67:cursor.isCircle=!cursor.isCircle,invalidate();break;case 73:secondaryLayerIndex=(secondaryLayerIndex+1)%numLayers,updateSecondaryImage(),updateSecondaryCard();break;case 74:sly.activate((primaryLayerIndex-1+numLayers)%numLayers);break;case 75:secondaryLayerIndex=(secondaryLayerIndex-1+numLayers)%numLayers,updateSecondaryImage(),updateSecondaryCard();break;case 76:sly.activate((primaryLayerIndex+1)%numLayers);break;case 77:nextPage();break;case 78:prevPage();break;case 79:break;case 85:break;default:return}});var sly=new Sly("#frame",{horizontal:1,itemNav:"forceCentered",smart:1,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:primaryLayerIndex,scrollBy:1,speed:300,elasticBounds:1,easing:"easeOutExpo",dragHandle:1,dynamicHandle:1,clickBar:1});sly.on("active",function(e,t){primaryLayerIndex!==t&&(primaryLayerIndex=t,updatePrimaryImage())}),sly.init(),$(window).resize(function(e){sly.reload()}),$("#layer-selector-fab").mouseenter(function(){$("#layer-selector-label").animate({opacity:"1.0"},"fast")}),$("#layer-selector-fab").mouseleave(function(){$("#layer-selector-label").animate({opacity:"0.0"},"fast")}),$("#help-button").mouseenter(function(){$("#help-label").animate({opacity:"1.0"},"fast")}),$("#help-button").mouseleave(function(){$("#help-label").animate({opacity:"0.0"},"fast")}),$("#help-button").click(function(){if(null==Shepherd.activeTour){primary.setMouseNavEnabled(!1),$(".navigator").hide();var e=document.getElementById("help-dialog");e.open()}}),$("#pageID").focusin(function(){$("#page-selector").slideDown(200)}),$("#pageID").focusout(function(){$("#page-selector").delay(50).slideUp(200)}),$(window).load(function(){fillSlider(),fillPageSelector(),Polymer.updateStyles(),sly.activate(primaryLayerIndex),updateSecondaryCard(),makeGhostCanvas(),addFlashlight(.5,.5,cursor.clipSize),sly.reload(),$("#help-button").click()});var tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",scrollTo:!1}});tour.addStep("welcome",{text:"This image viewer allows you to view and compare the pages of the Chad Gospels across time."}),backgroundText="The background image is showing us the page as it existed in ",tour.addStep("background",{text:backgroundText,attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 0"}});var flashlightText="The flashlight reveals the page as it existed at some other point in time. Right now, it's showing us what this page looked like in ";tour.addStep("flashlight",{text:flashlightText,attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 0"}}),tour.addStep("indicator",{text:"Move the flashlight by clicking and dragging this handle.",attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 -"+(flashlightIndicatorSize+10)},when:{show:startDemoRotation,hide:resetDemoRotation}}),tour.addStep("resize",{text:"Resize the flashlight by holding Shift and scrolling the mouse wheel.",attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 -"+(flashlightIndicatorSize+10)},when:{show:startDemoScroll,hide:resetDemoScroll}}),tour.addStep("selectedPrimary",{text:"The current background image is indicated in blue.",attachTo:".active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}});var idBeforeActive;tour.addStep("changePrimary",{text:"To change the background image, select another image from this list. Alternatively, use the J/L keys on the keyboard to cycle through the list.",attachTo:".active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("selectedFlashlight",{text:"The current flashlight image is indicated with a dot.",attachTo:".second-active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("changeFlashlight",{text:"To change the flashlight image, use the I/K keys on the keyboard to cycle through the list.",attachTo:".second-active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("changePage",{text:"To see other pages of the Chad Gospels, select them from this dropdown.",attachTo:"#page-selector right",beforeShowPromise:function(){$("#page-selector").show()},tetherOptions:{attachment:"middle right",targetAttachment:"middle left",offset:"0 5"},when:{hide:function(){$("#page-selector").slideUp(200)}}}),tour.addStep("help",{text:"To access this tour again, click the help button.",attachTo:"#help-button right",tetherOptions:{attachment:"top left",targetAttachment:"top right",offset:"10 -5"},buttons:[{text:"Get Started",action:tour.complete}]}),tour.on("complete",function(){_.each(tour.steps,function(e){e.destroy()}),primary.setMouseNavEnabled(!0),$(".navigator").show()});var original={},modulator,angle=0,theta=2,demoLight=0;
//# sourceMappingURL=layered-viewer.min.js.map