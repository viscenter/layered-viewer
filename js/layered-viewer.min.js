function pageNames(){return array=pages.map(function(e){return e.name}),array}function resetView(){primary.viewport.goHome(),secondary.viewport.goHome()}function zoomOut(){primary.viewport.zoomBy(.8)}function zoomIn(){primary.viewport.zoomBy(1.2)}function prevPage(){pageIndex=0!==pageIndex?(pageIndex-1+numPages)%numPages:numPages-1,updatePage()}function nextPage(){pageIndex=pageIndex!==numPages-1?(pageIndex+1)%numPages:0,updatePage()}function gotoPage(e){pageIndex=e,updatePage()}function invalidate(){isValid=!1}function validate(){0==isValid&&(primary.forceRedraw(),isValid=!0)}function Flashlight(){this.x=0,this.y=0,this.clipSize=10,this.fill="white",this.handle=""}function addFlashlight(e,t,a){var i=new Flashlight;i.x=e,i.y=t,i.clipSize=a,addHandle(flashlights.length,i),flashlights.push(i),invalidate()}function addHandle(e,t){var a=t.boundsPosition(),i=document.createElement("div");i.id="handle-"+e,$(i).addClass("circle handle"),primary.addOverlay({element:i,location:a,checkResize:!1}),new OpenSeadragon.MouseTracker({element:i.id,pressHandler:onHandlePress,releaseHandler:onHandleRelease,dragHandler:onHandleDrag}),t.handle=i}function onHandlePress(e){whichFlashlight=e.eventSource.element.id.split("-")[1],$("#primary").css("cursor","-webkit-grabbing"),$("#handle-"+whichFlashlight).css("cursor","-webkit-grabbing"),primary.zoomPerScroll=1}function onHandleDrag(e){e.preventDefaultAction=!0,e.stopBubbling=!0;var t=new OpenSeadragon.Point(e.delta.x*OpenSeadragon.pixelDensityRatio,e.delta.y*OpenSeadragon.pixelDensityRatio),a=t.divide(pc.width,pc.height),i=primary.viewport.getZoom();a=a.divide(i);var r=primary.world.getItemAt(0).getBounds();a.x=a.x/r.width,a.y=a.y/r.height,flashlights[whichFlashlight].x+=a.x,flashlights[whichFlashlight].y+=a.y,invalidate()}function onHandleRelease(e){$("#primary").css("cursor",""),$("#handle-"+whichFlashlight).css("cursor","-webkit-grab"),primary.zoomPerScroll=1.1,whichFlashlight=null,invalidate()}function resetContext(e){e.globalAlpha=1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0}function drawFlashlights(){for(var e=0;e<flashlights.length;e++)cursor.isCircle?cutCircle(flashlights[e].canvasPosition().x,flashlights[e].canvasPosition().y,flashlights[e].clipSize/2):cutSquare(flashlights[e].canvasPosition().x,flashlights[e].canvasPosition().y,flashlights[e].clipSize),$("#"+flashlights[e].handle.id).length?(primary.currentOverlays[e].update(flashlights[e].boundsPosition()),primary.currentOverlays[e].drawHTML(primary.overlaysContainer,primary.viewport)):addHandle(e,flashlights[e])}function cutCircle(e,t,a){a*=primary.viewport.getZoom(),ctx.save(),ctx.globalCompositeOperation="destination-out",ctx.beginPath(),ctx.arc(e,t,a,0,2*Math.PI,!1),ctx.fill(),ctx.restore()}function cutSquare(e,t,a){a*=primary.viewport.getZoom(),ctx.clearRect(e-a/2,t-a/2,a,a)}function updatePrimaryImage(){var e=primary.viewport.getZoom(!1),t=primary.viewport.getCenter(!1);primary.open(pages[pageIndex].layers[primaryLayerIndex].dzi),setTimeout(function(){primary.viewport.zoomTo(e,!0),primary.viewport.panTo(t,!0)},updateDelay)}function updateSecondaryImage(){var e=primary.viewport.getZoom(!1),t=primary.viewport.getCenter(!1);secondary.open(pages[pageIndex].layers[secondaryLayerIndex].dzi),setTimeout(function(){secondary.viewport.zoomTo(e,!0),secondary.viewport.panTo(t,!0)},updateDelay)}function updateSearchBar(){pageID.value=pages[pageIndex].name}function updatePage(){numLayers=pages[pageIndex].layers.length,primaryLayerIndex=Math.min(primaryLayerIndex,numLayers-1),secondaryLayerIndex=Math.min(secondaryLayerIndex,numLayers-1),updatePrimaryImage(),updateSecondaryImage(),updateSearchBar(),fillSlider(),sly.activate(primaryLayerIndex),updateSecondaryCard()}function onViewerScroll(e){if(e.shift){var t=15,a=primary.world.getItemAt(0).getContentSize().y;e.preventDefaultAction=!0;var i=e.originalEvent.wheelDelta/5,r=flashlights[0].clipSize+i;t>r?flashlights[0].clipSize=t:r>a?flashlights[0].clipSize=a:flashlights[0].clipSize=r,invalidate()}}function fillSlider(){for(cards=sly.items.length,i=0;i<cards;i++)sly.remove(0);for(i=0;i<numLayers;i++){version=pages[pageIndex].layers[i].version;var e="";e='<li id="'+i+'"><paper-material class="layer-card" elevation="1"><span class="vertically-aligned">'+version+"</span></paper-material></li>",sly.add(e)}}function fillPageSelector(){var e="";for(id=0;id<pageNames().length;id++)e='<li class="page-item" id="'+id+'" onclick="gotoPage('+id+')">'+pageNames()[id]+"</li>",$("#page-selector").append(e)}function updateSecondaryCard(){var e=$("#slidee").find(".second-active");e.removeClass("second-active"),e.find("span").find(".circle.indicator").remove();var t='<div class="circle indicator"></div>',a=$("#slidee").find("#"+secondaryLayerIndex);a.addClass("second-active"),a.find("span").prepend(t)}function toggleLayerSelector(){"none"==$("#layer-selector").css("display")?$("#layer-selector-toggle").animate({"margin-bottom":"-15px"},{step:function(e,t){var a=-(180*(e+15))/25;$(this).find("iron-icon").css("-ms-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("-webkit-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("transform","rotate("+a+"deg)")}},400):$("#layer-selector-toggle").animate({"margin-bottom":"10px"},{step:function(e,t){var a=180*(e+15)/25;$(this).find("iron-icon").css("-ms-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("-webkit-transform","rotate("+a+"deg)"),$(this).find("iron-icon").css("transform","rotate("+a+"deg)")}},400),$("#layer-selector").slideToggle(400),sly.reload()}function onHelpConfirm(){startTour()}function onHelpClose(){primary.setMouseNavEnabled(!0),$(".navigator").show()}function startTour(){primary.setMouseNavEnabled(!1),$(".navigator").hide(),resetView();var e=primary.viewport.contentSize.x*primary.viewport.viewportToImageZoom(primary.viewport.getZoom())/2;tour.getById("background").options.tetherOptions.offset="0 -"+e+"px",tour.getById("background").options.text=backgroundText+pages[pageIndex].layers[primaryLayerIndex].version+".";var t=flashlights[0].clipSize*primary.viewport.getZoom()/2;original.x=flashlights[demoLight].x,original.y=flashlights[demoLight].y,original.clipSize=flashlights[demoLight].clipSize,flashlights[demoLight].x=.5,flashlights[demoLight].y=.5,flashlights[demoLight].clipSize=500,tour.getById("flashlight").options.tetherOptions.offset="0 -"+t+"px",tour.getById("flashlight").options.text=flashlightText+pages[pageIndex].layers[secondaryLayerIndex].version+".",elemBeforeActive=$("li.active").prev(),0===elemBeforeActive.length?elemBeforeActive=$("li.active")[0]:elemBeforeActive=elemBeforeActive[0],tour.getById("changePrimary").options.attachTo={element:elemBeforeActive,on:"left"},"none"==$("#layer-selector").css("display")&&toggleLayerSelector(),tour.start()}function startDemoRotation(){var e={delta:{x:0,y:0}};movingFlashlight=!0,whichFlashlight=demoLight,flashlights[demoLight].x=.5,flashlights[demoLight].y=.5,e.delta.x=12.5,e.delta.y=-12.5,onHandleDrag(e),modulator=setInterval(function(){var t=Math.cos(.75*toRadian(angle)),a=Math.sin(.75*toRadian(angle));e.delta.x=t*primary.viewport.getZoom(),e.delta.y=a*primary.viewport.getZoom(),onHandleDrag(e),angle+=theta+.5},1)}function resetDemoRotation(){clearInterval(modulator),angle=0,flashlights[demoLight].x=.5,flashlights[demoLight].y=.5,movingFlashlight=!1,whichFlashlight=null,invalidate()}function startDemoScroll(){var e={originalEvent:{wheelDelta:0},shift:!0};whichFlashlight=demoLight,flashlights[demoLight].clipSize=500,modulator=setInterval(function(){e.originalEvent.wheelDelta=25*Math.sin(.75*toRadian(angle)),onViewerScroll(e),angle+=theta},1)}function resetDemoScroll(){clearInterval(modulator),angle=0,flashlights[demoLight].clipSize=500,shiftDown=!1,whichFlashlight=null,invalidate()}function toRadian(e){return e*Math.PI/180}function toDegree(e){return 180*e/Math.PI}function toggleMenu(){var e=document.getElementById("paperDrawerPanel");e.togglePanel()}var defaultImageSetJSONFile,defaultPageIndex,defaultprimaryLayerIndex,defaultSecondaryLayerIndex;"infoforest.vis.uky.edu"==window.location.hostname?(defaultImageSetJSONFile="data/chad.json",defaultPageIndex=223,defaultPrimaryLayerIndex=4,defaultSecondaryLayerIndex=2):(defaultImageSetJSONFile="data/test/test.json",defaultPageIndex=0,defaultPrimaryLayerIndex=0,defaultSecondaryLayerIndex=1);var OSDprefixURL="external/openseadragon/images/",showNav=!0,showFull=!1,showScale=!0,scaleMinWidth="75px",minZoom=.15,maxZoom=2,animationTime=0,imageSetJSONFile=defaultImageSetJSONFile,pageIndex=defaultPageIndex,primaryLayerIndex=defaultPrimaryLayerIndex,secondaryLayerIndex=defaultSecondaryLayerIndex,movingFlashlight=!1,whichFlashlight=null,cursor={clipSize:500,isCircle:!0},json=$.ajax({url:imageSetJSONFile,async:!1,dataType:"json"}).responseText,pages=$.parseJSON(json).pages,numPages=pages.length,numLayers=pages[pageIndex].layers.length,primary=OpenSeadragon({id:"primary",prefixUrl:OSDprefixURL,tileSources:pages[pageIndex].layers[primaryLayerIndex].dzi,showNavigator:showNav,navigatorID:"navigator-wrapper",navigatorMaintainSizeRatio:!0,animationTime:animationTime,minZoomLevel:minZoom,maxZoomLevel:maxZoom,showFullPageControl:!1,showNavigationControl:!1,zoomPerScroll:1.1}),secondary=OpenSeadragon({id:"secondary",prefixUrl:OSDprefixURL,tileSources:pages[pageIndex].layers[secondaryLayerIndex].dzi,showNavigator:!1,animationTime:animationTime,minZoomLevel:minZoom,maxZoomLevel:maxZoom,showFullPageControl:!1,showNavigationControl:!1});showScale&&primary.scalebar({type:OpenSeadragon.ScalebarType.MAP,minWidth:scaleMinWidth,pixelsPerMeter:pages[pageIndex].layers[primaryLayerIndex].pixelsPerMeter,location:OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,xOffset:5,yOffset:10,stayInsideImage:!0,color:"rgba(255, 255, 255, .75)",fontColor:"rgba(255, 255, 255, .75)",fontSize:"small",barThickness:2}),primary.addHandler("pan",function(e){primary&&secondary&&secondary.viewport&&secondary.viewport.panTo(primary.viewport.getCenter(!1)),invalidate()}),primary.addHandler("zoom",function(e){primary&&secondary&&secondary.viewport&&(secondary.viewport.panTo(primary.viewport.getCenter(!1)),secondary.viewport.zoomTo(primary.viewport.getZoom(!1))),invalidate()}),primary.addViewerInputHook({hooks:[{tracker:"viewer",handler:"scrollHandler",hookHandler:onViewerScroll}]}),updateSearchBar();var pc=primary.canvas.children[0];pc||(console.log("Browser must support canvas for client to function."),console.log("Try the latest versions of Firefox or Chromium."),exit(0));var ctx=pc.getContext("2d");setInterval(validate,1),isValid=!1,primary.addHandler("tile-drawn",drawFlashlights);var flashlights=[];Flashlight.prototype.boundsPosition=function(){var e=primary.world.getItemAt(0),t=e.getBounds();return new OpenSeadragon.Point(this.x*t.width,this.y*t.height)},Flashlight.prototype.canvasPosition=function(){var e=primary.world.getItemAt(0),t=primary.viewport.getCenter(),a=e.viewport.getZoom(),i=this.boundsPosition(),r=i.minus(t);r=r.times(a),r=r.times(pc.width,pc.height);var o=new OpenSeadragon.Point(pc.width/2,pc.height/2);return o.plus(r)};var updateDelay=50,waitForFinalEvent=function(){var e={};return function(t,a,i){i||(i="Don't call this twice without a uniqueId"),e[i]&&clearTimeout(e[i]),e[i]=setTimeout(t,a)}}();$(window).resize(function(e){waitForFinalEvent(function(){secondary.viewport.panTo(primary.viewport.getCenter(!1)),secondary.viewport.zoomTo(primary.viewport.getZoom(!1)),invalidate()},50,"resize")});var shiftDown=!1;$(document).keyup(function(e){switch(e.which){default:return}}),$(document).keydown(function(e){switch(e.which){case 67:cursor.isCircle=!cursor.isCircle,invalidate();break;case 73:secondaryLayerIndex=(secondaryLayerIndex+1)%numLayers,updateSecondaryImage(),updateSecondaryCard();break;case 74:sly.activate((primaryLayerIndex-1+numLayers)%numLayers);break;case 75:secondaryLayerIndex=(secondaryLayerIndex-1+numLayers)%numLayers,updateSecondaryImage(),updateSecondaryCard();break;case 76:sly.activate((primaryLayerIndex+1)%numLayers);break;case 77:nextPage();break;case 78:prevPage();break;case 79:break;case 85:break;default:return}});var sly=new Sly("#frame",{horizontal:1,itemNav:"forceCentered",smart:1,activateOn:"click",mouseDragging:1,touchDragging:1,releaseSwing:1,startAt:primaryLayerIndex,scrollBy:1,speed:300,elasticBounds:1,easing:"easeOutExpo",dragHandle:1,dynamicHandle:1,clickBar:1});sly.on("active",function(e,t){primaryLayerIndex!==t&&(primaryLayerIndex=t,updatePrimaryImage())}),sly.init(),$(window).resize(function(e){sly.reload()}),$("#layer-selector-fab").mouseenter(function(){$("#layer-selector-label").animate({opacity:"1.0"},"fast")}),$("#layer-selector-fab").mouseleave(function(){$("#layer-selector-label").animate({opacity:"0.0"},"fast")}),$("#help-button").mouseenter(function(){$("#help-label").animate({opacity:"1.0"},"fast")}),$("#help-button").mouseleave(function(){$("#help-label").animate({opacity:"0.0"},"fast")}),$("#help-button").click(function(){null==Shepherd.activeTour&&(primary.setMouseNavEnabled(!1),$(".navigator").hide(),$("#help-dialog")[0].open())}),$("#pageID").focusin(function(){$("#page-selector").slideDown(200)}),$("#pageID").focusout(function(){$("#page-selector").delay(50).slideUp(200)}),$(window).load(function(){fillSlider(),fillPageSelector(),Polymer.updateStyles(),sly.activate(primaryLayerIndex),updateSecondaryCard(),sly.reload(),setTimeout(function(){addFlashlight(.5,.5,cursor.clipSize)},500),$("#help-button").click()});var tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",scrollTo:!1}});tour.addStep("welcome",{text:"This image viewer allows you to view and compare the pages of the Chad Gospels across time."}),backgroundText="The background image is showing us the page as it existed in ",tour.addStep("background",{text:backgroundText,attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 0"}});var flashlightText="The flashlight reveals the page as it existed at some other point in time. Right now, it's showing us what this page looked like in ";tour.addStep("flashlight",{text:flashlightText,attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 0"}}),tour.addStep("indicator",{text:"Move the flashlight by clicking and dragging this handle.",attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 -20"},when:{show:startDemoRotation,hide:resetDemoRotation}}),tour.addStep("resize",{text:"Resize the flashlight by holding Shift and scrolling the mouse wheel.",attachTo:"#primary left",tetherOptions:{attachment:"middle left",targetAttachment:"middle center",offset:"0 -20"},when:{show:startDemoScroll,hide:resetDemoScroll}}),tour.addStep("selectedPrimary",{text:"The current background image is indicated in blue.",attachTo:".active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}});var idBeforeActive;tour.addStep("changePrimary",{text:'To change the background image, select another image from this list. Alternatively, use the <span class="tour-emphasis">J/L</span> keys on the keyboard to cycle through the list.',attachTo:".active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("selectedFlashlight",{text:"The current flashlight image is indicated with a dot.",attachTo:".second-active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("changeFlashlight",{text:'To change the flashlight image, use the <span class="tour-emphasis">I/K</span> keys on the keyboard to cycle through the list.',attachTo:".second-active left",tetherOptions:{attachment:"bottom center",targetAttachment:"top center",offset:"-5 0"}}),tour.addStep("changePage",{text:"To see other pages of the Chad Gospels, select them from this dropdown.",attachTo:"#page-selector right",beforeShowPromise:function(){$("#page-selector").show()},tetherOptions:{attachment:"middle right",targetAttachment:"middle left",offset:"0 5"},when:{hide:function(){$("#page-selector").slideUp(200)}}}),tour.addStep("help",{text:"To access this tour again, click the help button.",attachTo:"#help-button right",tetherOptions:{attachment:"top left",targetAttachment:"top right",offset:"10 -5"},buttons:[{text:"Get Started",action:tour.complete}]}),tour.on("complete",function(){flashlights[demoLight].x=original.x,flashlights[demoLight].y=original.y,flashlights[demoLight].clipSize=original.clipSize,original={},_.each(tour.steps,function(e){e.destroy()}),primary.setMouseNavEnabled(!0),$(".navigator").show(),invalidate()});var original={},modulator,angle=0,theta=2,demoLight=0;
//# sourceMappingURL=layered-viewer.min.js.map